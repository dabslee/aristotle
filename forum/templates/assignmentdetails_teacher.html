{% extends 'base.html' %}
{% load static %}

{% block content %}
<form action="{% url 'forum:assignmentdetails' assignment.id %}" method="POST">
    {% csrf_token %}
    <div style="display: flex; flex-direction: row; justify-content: space-between;">
        <div>
            <div class="form-group row">
                <h2 class="col-sm-5">Assignment name:</h2>
                <div class="col-sm-7">
                    <input class="form-control form-control-lg" name="title" type="text" value="{{assignment.title}}"></input>
                </div>
            </div>
            <label class="form-label">Start date: </label><input class="form-control" name="start" type="datetime-local" value="{{assignment.start_datetime|date:'Y-m-d\TH:i'}}"></input>
            <label class="form-label">End date: </label><input class="form-control" name="end" type="datetime-local" value="{{assignment.end_datetime|date:'Y-m-d\TH:i'}}"></input><br>
            <label class="form-label">Total points: </label><input class="form-control" name="points" type="number" value="{{assignment.total_points}}"></input><br>
            <label class="form-label">Module: </label><select name="module" class="form-select">
                <option value="No module">No module</option>
                {% for assnmodule in modules %}
                <option value="{{assnmodule}}"{% if modulename == assnmodule %}selected{% endif %}>{{assnmodule}}</option>
                {% endfor %}
            </select>
            <label class="form-label">Description: </label>
            <textarea name="description" class="form-control" rows="10" cols="100">{{assignment.description}}</textarea>
        </div>
        <div class="btn btn-danger" onclick="delete_assn()" style="height: fit-content">Delete assignment</div>
        <script>
            function delete_assn() {
                if (confirm("Are you sure you want to delete this assignment?")) {
                    location.href = "{% url 'forum:delete_assignment' assignment.id %}";
                }
            }
        </script>
    </div>
    <br>
    <input class="btn btn-primary mb-2" type="submit" value="Save changes">
    {% if savedmessage %}
    <div class="alert alert-success">{{savedmessage}}</div>
    {% endif %}
</form>
<h2>Review submissions:</h2>
<table class="table">
    <thead>
        <tr>
            <th>Student</th>
            <th># Submissions</th>
            <th>Grade</th>
            <th>Percent grade</th>
            <th>Review submissions</th>
        </tr>
    </thead>
    <tbody>
        {% for student in students %}
        <tr>
            <td>{{student.username}}</td>
            <td>{{student.nosubmissions}}</td>
            <td>
                {% if student.grade != None %}{{student.grade}}{% else %}--{% endif %}
                / {% if assignment.total_points != None %}{{assignment.total_points}}{% else %}--{% endif %}
            </td>
            <td>{{student.percentgrade}}%</td>
            <td><a href="{{student.link}}"><div class="btn btn-primary">Review submission</div></a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<link rel="stylesheet" href="{% static 'css/table.css' %}">
{% endblock %}